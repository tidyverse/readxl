<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="readxl">
<title>readxl Workflows • readxl</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="readxl Workflows">
<meta property="og:description" content="readxl">
<meta property="og:image" content="https://readxl.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="readxl.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">readxl</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/column-names.html">Column Names</a>
    <a class="dropdown-item" href="../articles/multiple-header-rows.html">Multiple Header Rows</a>
    <a class="dropdown-item" href="../articles/readxl-workflows.html">readxl Workflows</a>
    <a class="dropdown-item" href="../articles/cell-and-column-types.html">Cell and Column Types</a>
    <a class="dropdown-item" href="../articles/sheet-geometry.html">Sheet Geometry</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/03/readxl-1-4-0/">Version 1.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/12/readxl-1-2-0/">Version 1.2.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/04/readxl-1-1-0/">Version 1.1.0</a>
    <a class="external-link dropdown-item" href="https://www.rstudio.com/blog/readxl-1-0-0/">Version 1.0.0</a>
    <a class="external-link dropdown-item" href="https://www.rstudio.com/blog/readxl-0-1-0/">Version 0.1.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/readxl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>readxl Workflows</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/readxl/blob/HEAD/vignettes/articles/readxl-workflows.Rmd" class="external-link"><code>vignettes/articles/readxl-workflows.Rmd</code></a></small>
      <div class="d-none name"><code>readxl-workflows.Rmd</code></div>
    </div>

    
    
<p>Ideas for using readxl to increase reproducibility and reduce
tedium.</p>
<p>Reproducibility is much easier in theory than in reality. Here are
some special dilemmas we face with spreadsheets:</p>
<ul>
<li>We say: Keep raw data raw! But we also say: Store data in a
tool-agnostic, future-proof format! If data comes in the form of an
<code>.xls[x]</code> file, we’re in a pickle. The <code>.xls[x]</code>
file should obviously be preserved, and probably write-protected. But a
faithful copy as CSV is a wonderful complement, as long as you can
ensure the two are the same.</li>
<li>We say: Don’t do analysis “by hand” or “by mouse”! But then we break
this rule by manually exporting spreadsheets to file with <em>File &gt;
Save As … &gt; (save to <code>.csv</code>)</em>. readxl helps you get
data directly out of a spreadsheet and into R, where you can record
every step of your analysis as code. Below we show how to cache a CSV
snapshot as part of this process.</li>
</ul>
<p>The examples below also demonstrate the use of functional programming
or “apply” techniques to iterate over the worksheets in a workbook.</p>
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<p>We load the tidyverse metapackage here because the workflows below
show readxl working with readr, purrr, etc. See the last section for
solutions using base R only (other than readxl).</p>
<p>We must load readxl explicitly because it is not part of the core
tidyverse.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ──────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cache-a-csv-snapshot">Cache a CSV snapshot<a class="anchor" aria-label="anchor" href="#cache-a-csv-snapshot"></a>
</h2>
<p>Break analyses into logical steps, via a series of scripts that
relate to one theme, such as “clean the data” or “make exploratory and
diagnostic plots”.</p>
<p>This forces you to transmit info from step i to step i + 1 via a set
of output files. The cumulative outputs of steps 1, 2, …, i are
available as inputs for steps i + 1 and beyond.</p>
<p>These outputs constitute <a href="https://www.quora.com/What-is-an-API-4" class="external-link">an API</a> for your
analysis, i.e. they provide clean entry points that can be used (and
understood) in isolation, possibly using an entirely different toolkit.
Contrast this with the alternative of writing one monolithic script or
transmitting entire workspaces via <code><a href="https://rdrr.io/r/base/save.html" class="external-link">save()</a></code>,
<code><a href="https://rdrr.io/r/base/load.html" class="external-link">load()</a></code>, and R-specific <code>.rds</code> files.</p>
<p>If raw data is stored <em>only</em> as an Excel spreadsheet, this
limits your ability to inspect it when solving the little puzzles that
crop up in dowstream work. You’ll need to fire up Excel (or similar) and
get busy with your mouse. You certainly can’t poke around it or view
diffs on GitHub.</p>
<p>Solution: cache a CSV snapshot of your raw data tables at the time of
export. Even if you use <code><a href="../reference/read_excel.html">read_excel()</a></code> for end-to-end
reproducibility, this complementary CSV leaves your analysis in a more
accessible state.</p>
<p>Pipe the output of <code><a href="../reference/read_excel.html">read_excel()</a></code> directly into
<code><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">readr::write_csv()</a></code> like so:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xlsx"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span>sheet <span class="op">=</span> <span class="st">"iris"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"iris-raw.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Why does this work? <code><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">readr::write_csv()</a></code> is a
well-mannered “write” function: it does its main job <em>and returns its
input invisibly</em>. The above command reads the iris sheet from
readxl’s <code>datasets.xlsx</code> example workbook and caches a CSV
version of the resulting data frame to file.</p>
<p>Let’s check. Did we still import the data? Did we write the CSV
file?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_xl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 5</span></span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          5.1         3.5          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          4.9         3            1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          4.7         3.2          1.3         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 147 more rows</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"iris"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "iris-raw.csv"</span></span></code></pre></div>
<p>Yes! Is the data written to CSV an exact copy of what we imported
from Excel?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"iris-raw.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">150</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (1): Species</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (4): Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## readr leaves a note-to-self in `spec` that records its column guessing,</span></span>
<span><span class="co">## so we remove that attribute before the check</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">iris_alt</span>, <span class="st">"spec"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">iris_xl</span>, <span class="va">iris_alt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Yes! If we needed to restart or troubleshoot this fictional analysis,
<code>iris-raw.csv</code> is available as a second, highly accessible
alternative to <code>datasets.xlsx</code>.</p>
</div>
<div class="section level2">
<h2 id="iterate-over-multiple-worksheets-in-a-workbook">Iterate over multiple worksheets in a workbook<a class="anchor" aria-label="anchor" href="#iterate-over-multiple-worksheets-in-a-workbook"></a>
</h2>
<p>Some Excel workbooks contain only data and you are tempted to ask
“Why, God, why is this data stored in Excel? Why not store this as a
series of CSV files?” One possible answer is this: because the workbook
structure keeps them all together.</p>
<p>Let’s accept that this happens and that it is not entirely crazy. How
can you efficiently load all of that into R?</p>
<p>Here’s how to load all the sheets in a workbook into a list of data
frames:</p>
<ul>
<li>Get worksheet names as a self-named character vector (these names
propagate nicely).</li>
<li>Use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> to iterate sheet reading.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xlsx"</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">read_excel</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; $iris</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 5</span></span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          5.1         3.5          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          4.9         3            1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          4.7         3.2          1.3         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 147 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mtcars</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 11</span></span></span>
<span><span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  21       6   160   110  3.9   2.62  16.5     0     1     4     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  21       6   160   110  3.9   2.88  17.0     0     1     4     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 29 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $chickwts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 71 × 2</span></span></span>
<span><span class="co">#&gt;   weight feed     </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    179 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    160 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    136 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 68 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $quakes</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,000 × 5</span></span></span>
<span><span class="co">#&gt;     lat  long depth   mag stations</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000;">20.4</span>  182.   562   4.8       41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> -<span style="color: #BB0000;">20.6</span>  181.   650   4.2       15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> -<span style="color: #BB0000;">26</span>    184.    42   5.4       43</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 997 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="csv-caching-and-iterating-over-sheets">CSV caching and iterating over sheets<a class="anchor" aria-label="anchor" href="#csv-caching-and-iterating-over-sheets"></a>
</h2>
<p>What if we want to read all the sheets in at once and simultaneously
cache to CSV? We define <code>read_then_csv()</code> as
<code>read_excel(...) %&gt;% write_csv()</code> and use
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> again.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_then_csv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sheet</span>, <span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pathbase</span> <span class="op">&lt;-</span> <span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span>sheet <span class="op">=</span> <span class="va">sheet</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pathbase</span>, <span class="st">"-"</span>, <span class="va">sheet</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We could even define this on-the-fly as an anonymous function inside
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code>, but I think this is more readable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xlsx"</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">read_then_csv</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; $iris</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 150 × 5</span></span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          5.1         3.5          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          4.9         3            1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          4.7         3.2          1.3         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 147 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mtcars</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 × 11</span></span></span>
<span><span class="co">#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  21       6   160   110  3.9   2.62  16.5     0     1     4     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  21       6   160   110  3.9   2.88  17.0     0     1     4     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 29 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $chickwts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 71 × 2</span></span></span>
<span><span class="co">#&gt;   weight feed     </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    179 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    160 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    136 horsebean</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 68 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $quakes</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,000 × 5</span></span></span>
<span><span class="co">#&gt;     lat  long depth   mag stations</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000;">20.4</span>  182.   562   4.8       41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> -<span style="color: #BB0000;">20.6</span>  181.   650   4.2       15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> -<span style="color: #BB0000;">26</span>    184.    42   5.4       43</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 997 more rows</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^datasets.*\\.csv$"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "datasets-chickwts.csv" "datasets-iris.csv"    </span></span>
<span><span class="co">#&gt; [3] "datasets-mtcars.csv"   "datasets-quakes.csv"</span></span></code></pre></div>
<p>In a real analysis, starting with workbook <code>"foo.xlsx"</code>,
you might want to create the directory <code>foo</code> and place the
CSVs inside that.</p>
</div>
<div class="section level2">
<h2 id="concatenate-worksheets-into-one-data-frame">Concatenate worksheets into one data frame<a class="anchor" aria-label="anchor" href="#concatenate-worksheets-into-one-data-frame"></a>
</h2>
<p>What if the datasets found on different sheets have the same
variables? Then you’ll want to row-bind them, after import, to form one
big, beautiful data frame.</p>
<p>readxl ships with an example sheet <code>deaths.xlsx</code>,
containing data on famous people who died in 2016 or 2017. It has two
worksheets named “arts” and “other”, but the spreadsheet layout is the
same in each and the data tables have the same variables, e.g., name and
date of death.</p>
<p>The <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df()</a></code> function from purrr makes it easy to
iterate over worksheets and glue together the resulting data frames, all
at once.</p>
<ul>
<li>Store a self-named vector of worksheet names (critical for the ID
variable below).</li>
<li>Use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">purrr::map_df()</a></code> to import the data, create an ID
variable for the source worksheet, and row bind.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"deaths.xlsx"</span><span class="op">)</span></span>
<span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, sheet <span class="op">=</span> <span class="va">.x</span>, range <span class="op">=</span> <span class="st">"A5:F15"</span><span class="op">)</span>, .id <span class="op">=</span> <span class="st">"sheet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">deaths</span>, n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    sheet Name              Profession   Age `Has kids` `Date of birth`    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> arts  David Bowie       musician      69 TRUE       1947-01-08 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> arts  Carrie Fisher     actor         60 TRUE       1956-10-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> arts  Chuck Berry       musician      90 TRUE       1926-10-18 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> arts  Bill Paxton       actor         61 TRUE       1955-05-17 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> arts  Prince            musician      57 TRUE       1958-06-07 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> arts  Alan Rickman      actor         69 FALSE      1946-02-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> arts  Florence Henders… actor         82 TRUE       1934-02-14 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> arts  Harper Lee        author        89 FALSE      1926-04-28 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> arts  Zsa Zsa Gábor     actor         99 TRUE       1917-02-06 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> arts  George Michael    musician      53 FALSE      1963-06-25 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> other Vera Rubin        scientist     88 TRUE       1928-07-23 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> other Mohamed Ali       athlete       74 TRUE       1942-01-17 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> other Morley Safer      journalist    84 TRUE       1931-11-08 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> other Fidel Castro      politician    90 TRUE       1926-08-13 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> other Antonin Scalia    lawyer        79 TRUE       1936-03-11 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> other Jo Cox            politician    41 TRUE       1974-06-22 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> other Janet Reno        lawyer        78 FALSE      1938-07-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> other Gwen Ifill        journalist    61 FALSE      1955-09-29 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> other John Glenn        astronaut     95 TRUE       1921-07-28 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> other Pat Summit        coach         64 TRUE       1952-06-14 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: `Date of death` &lt;dttm&gt;</span></span></span></code></pre></div>
<p>Note the use of <code>range = "A5:E15"</code> here.
<code>deaths.xlsx</code> is a typical spreadsheet and includes a few
non-data lines at the top and bottom and this argument specifies where
the data rectangle lives.</p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>All at once now:</p>
<ul>
<li>Multiple worksheets feeding into one data frame</li>
<li>Sheet-specific target rectangles</li>
<li>Cache to CSV upon import</li>
</ul>
<p>Even though the worksheets in <code>deaths.xlsx</code> have the same
layout, we’ll pretend they don’t and specify the target rectangle in two
different ways here. This shows how this can work if each worksheet has
it’s own peculiar geometry. Here’s the workflow:</p>
<ul>
<li>Store a self-named vector of worksheet names.</li>
<li>Store a vector of cell range specifications.</li>
<li>Use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">purrr::map2_df()</a></code> to iterate over those two vectors
in parallel, importing the data, row binding, and creating an ID
variable for the source worksheet.</li>
<li>Cache the unified data to CSV.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"deaths.xlsx"</span><span class="op">)</span></span>
<span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="va">path</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A5:F15"</span>, <span class="fu"><a href="../reference/cell-specification.html">cell_rows</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_df</a></span><span class="op">(</span></span>
<span>  <span class="va">sheets</span>,</span>
<span>  <span class="va">ranges</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span>, sheet <span class="op">=</span> <span class="va">.x</span>, range <span class="op">=</span> <span class="va">.y</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"sheet"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"deaths.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">deaths</span>, n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    sheet Name              Profession   Age `Has kids` `Date of birth`    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> arts  David Bowie       musician      69 TRUE       1947-01-08 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> arts  Carrie Fisher     actor         60 TRUE       1956-10-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> arts  Chuck Berry       musician      90 TRUE       1926-10-18 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> arts  Bill Paxton       actor         61 TRUE       1955-05-17 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> arts  Prince            musician      57 TRUE       1958-06-07 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> arts  Alan Rickman      actor         69 FALSE      1946-02-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> arts  Florence Henders… actor         82 TRUE       1934-02-14 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> arts  Harper Lee        author        89 FALSE      1926-04-28 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> arts  Zsa Zsa Gábor     actor         99 TRUE       1917-02-06 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> arts  George Michael    musician      53 FALSE      1963-06-25 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> other Vera Rubin        scientist     88 TRUE       1928-07-23 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> other Mohamed Ali       athlete       74 TRUE       1942-01-17 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> other Morley Safer      journalist    84 TRUE       1931-11-08 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> other Fidel Castro      politician    90 TRUE       1926-08-13 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> other Antonin Scalia    lawyer        79 TRUE       1936-03-11 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> other Jo Cox            politician    41 TRUE       1974-06-22 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> other Janet Reno        lawyer        78 FALSE      1938-07-21 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> other Gwen Ifill        journalist    61 FALSE      1955-09-29 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> other John Glenn        astronaut     95 TRUE       1921-07-28 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> other Pat Summit        coach         64 TRUE       1952-06-14 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: `Date of death` &lt;dttm&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="base-version">Base version<a class="anchor" aria-label="anchor" href="#base-version"></a>
</h2>
<p>Rework examples from above but using base R only, other than
readxl.</p>
<div class="section level3">
<h3 id="cache-a-csv-snapshot-1">Cache a CSV snapshot<a class="anchor" aria-label="anchor" href="#cache-a-csv-snapshot-1"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_xl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xlsx"</span><span class="op">)</span>, sheet <span class="op">=</span> <span class="st">"iris"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">iris_xl</span>, <span class="st">"iris-raw.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">iris_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"iris-raw.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## coerce iris_xl back to a data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">iris_xl</span><span class="op">)</span>, <span class="va">iris_alt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="iterate-over-multiple-worksheets-in-a-workbook-1">Iterate over multiple worksheets in a workbook<a class="anchor" aria-label="anchor" href="#iterate-over-multiple-worksheets-in-a-workbook-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xls"</span><span class="op">)</span></span>
<span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="va">read_excel</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xl_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sheets</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="csv-caching-and-iterating-over-sheets-1">CSV caching and iterating over sheets<a class="anchor" aria-label="anchor" href="#csv-caching-and-iterating-over-sheets-1"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_then_csv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sheet</span>, <span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pathbase</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, sheet <span class="op">=</span> <span class="va">sheet</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">pathbase</span>, <span class="st">"-"</span>, <span class="va">sheet</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"datasets.xlsx"</span><span class="op">)</span></span>
<span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="va">read_then_csv</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xl_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sheets</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="concatenate-worksheets-into-one-data-frame-1">Concatenate worksheets into one data frame<a class="anchor" aria-label="anchor" href="#concatenate-worksheets-into-one-data-frame-1"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"deaths.xlsx"</span><span class="op">)</span></span>
<span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="va">read_excel</span>, path <span class="op">=</span> <span class="va">path</span>, range <span class="op">=</span> <span class="st">"A5:F15"</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sheets</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sheet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">sheets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">xl_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">xl_list</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="putting-it-all-together-1">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together-1"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"deaths.xlsx"</span><span class="op">)</span></span>
<span><span class="va">sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A5:F15"</span>, <span class="fu"><a href="../reference/cell-specification.html">cell_rows</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/read_excel.html">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, sheet <span class="op">=</span> <span class="va">x</span>, range <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">sheets</span>, <span class="va">ranges</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sheets</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sheet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">sheets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">xl_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">xl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">xl_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">xl_list</span>, <span class="st">"deaths.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
